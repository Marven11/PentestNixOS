{ pkgs, lib }:
let
  libPath = with pkgs; lib.makeLibraryPath [
    xorg.libXtst.out
    xorg.libXxf86vm
    libGL
  ];
in
pkgs.stdenv.mkDerivation (with pkgs; rec {
  pname = "JNDI-Injection-Exploit";
  version = "1.0";

  nativeBuildInputs = [ makeWrapper ];

  sourceRoot = ".";

  dontUnpack = true;
  dontConfigure = true;
  dontBuild = true;

  installPhase = ''
    runHook preInstall
    mkdir $out/share -p
    cp $src $out/share/JNDI-Injection-Exploit-${version}-SNAPSHOT-all.jar
    runHook postInstall
  '';


  postFixup = ''
    makeWrapper ${jre}/bin/java $out/bin/JNDI-Injection-Exploit \
      --add-flags "-jar $out/share/JNDI-Injection-Exploit-${version}-SNAPSHOT-all.jar" \
      --prefix PATH : ${lib.makeBinPath [ jre ]} \
      --set JAVA_HOME ${lib.getBin jre} \
      "''${gappsWrapperArgs[@]}"
  '';

  src = pkgs.fetchurl {
    url = "https://github.com/Marven11/JNDI-Injection-Exploit/releases/download/${version}/JNDI-Injection-Exploit-${version}-SNAPSHOT-all.jar";
    sha256 = "sha256-pKQFM6rsMkq4QrnPkgNwzNvL1GOJxPnOrrcuRrd6mOE=";
  };

})
