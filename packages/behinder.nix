{ pkgs, lib }:
let
  libPath = with pkgs; lib.makeLibraryPath [
    xorg.libXtst.out
    xorg.libXxf86vm
    libGL
  ];
in
pkgs.stdenv.mkDerivation (with pkgs; rec {
  pname = "behinder";
  version = "4.1";

  nativeBuildInputs = [ makeWrapper ];

  sourceRoot = ".";
  unpackCmd = "${pkgs.unzip}/bin/unzip $src -d behinder";

  dontConfigure = true;
  dontBuild = true;

  installPhase = ''
    runHook preInstall

    mkdir -p $out/share
    cp -R behinder $out/share/
    runHook postInstall
  '';


  postFixup = ''
    makeWrapper ${jre}/bin/java $out/bin/Behinder \
      --add-flags "-jar $out/share/behinder/Behinder.jar" \
      --prefix LD_LIBRARY_PATH : ${libPath} \
      --prefix PATH : ${lib.makeBinPath [ jre ]} \
      --set JAVA_HOME ${lib.getBin jre} \
      --chdir $out/share/behinder/ \
      "''${gappsWrapperArgs[@]}"
  '';

  src = pkgs.fetchurl {
    url = "https://github.com/rebeyond/Behinder/releases/download/Behinder_v${version}%E3%80%90t00ls%E4%B8%93%E7%89%88%E3%80%91/Behinder_v${version}.t00ls.zip";
    sha256 = "sha256-HpYNTBwA+jCP6dpr+yB2SjecuM9Lh08kVtGZgubGiMI=";
  };

})
