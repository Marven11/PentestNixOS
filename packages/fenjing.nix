{ pkgs, lib, fetchFromGitHub, ... }@inputs:
with pkgs.python3Packages; buildPythonPackage rec {
  pname = "fenjing";
  # it takes minutes
  doCheck = false;

  nativeBuildInputs = [ pkgs.installShellFiles ];

  build-system = [
    setuptools
    setuptools-scm
  ];

  dependencies = [
    requests
    beautifulsoup4
    click
    flask
    jinja2
    prompt-toolkit
    pygments
    pysocks
  ];

  postInstall = ''
    installShellCompletion --cmd fenjing \
      --bash <(_FOO_BAR_COMPLETE=bash_source fenjing) \
      --fish <(_FOO_BAR_COMPLETE=fish_source fenjing) \
      --zsh <(_FOO_BAR_COMPLETE=zsh_source fenjing) \
  '';

  src = fetchFromGitHub {
    owner = "Marven11";
    repo = "fenjing";
    rev = "519b09a81ffe8241226c3009ca070b66ef728486"; # v0.6.8
    sha256 = "sha256-QBjI12ax50m2F74TDN8zPoqxwqQiKPHODYkMKF/n/1w=";
  };
  version = (lib.strings.removeSuffix "\n" (builtins.readFile "${src}/VERSION"));
}
